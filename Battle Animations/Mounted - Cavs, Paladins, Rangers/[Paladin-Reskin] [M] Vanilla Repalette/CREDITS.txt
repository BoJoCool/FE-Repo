Fixes by Pushwall.

Staff by Primefusion and ported by Citrus.